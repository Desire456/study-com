<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/style.css">
    <title>StudyCom</title>
    <script>
        // $(function () {...}); вызывает функцию после загрузки страницы
        $(function() {

            /**
             * Конструктор, инициализирующий логику списка дел
             * на элементе с правильной версткой
             * Параметры:
             *  - DOM-элемент, являющийся контейнером списка
             *    (уже с нужными дочерними элементами)
             */
            function Todo(elem) {
                // Ищем вложенные элементы, которые будут использованы в дальнейшем
                // Если их не будет - ошибки не возникнет, просто создадутся пустые jQuery-объекты
                this.eList = elem.find('.todo__list');
                this.eText = elem.find('.todo__text');
                this.eButton = elem.find('.todo__add');

                // Кешируем контекст вызова (созданный объект),
                // чтобы использовать его в обработчиках
                var that = this;

                // Добавляем обработчик изменения поля ввода
                this.eText.on('input', function () {
                    // Поле ввода не пусто => разблокируем кнопку "Добавить", иначе блокируем
                    that.eButton.prop('disabled', !this.value);
                    // здесь this - это тот элемент, на котором случилось событие
                });

                // Добавляем обработчик нажатия на кнопку "Добавить"
                // (не сработает, если кнопка заблокирована)
                this.eButton.on('click', function () {
                    var val = that.eText.val();

                    // Если поле ввода не пусто
                    if (val) {
                        // вызываем метод добавления элемента в список
                        that.addItem(val);

                        // очищаем поле и блокируем кнопку
                        // (при изменении поля в коде обработчик изменения поля не вызывается)
                        that.eText.val('');
                        that.eButton.prop('disabled', true);
                    }
                });

                // Добавляем обработчик изменения статусов элементов списка (на сам список)
                // jQuery позволяет обрабатывать событие на всех дочерних элементах,
                // попадающих в условие селектора (второй параметр) -
                // в данном случае, на всех элементах списка
                // это позволяет не подписывать обработчик на каждый элемент отдельно
                this.eList.on('click', '.todo__list-item', function () {
                    var COMPLETED_CLASS = 'todo__list-item_completed_yes';
                    var item = $(this);

                    item.hasClass(COMPLETED_CLASS) ?
                        item.removeClass(COMPLETED_CLASS) :
                        item.addClass(COMPLETED_CLASS);
                });

                // Добавляем обработчик клика по удалялке внутри элемента списка
                // Добавляем тоже на список, чтобы не возиться с каждым элементом по отдельности
                this.eList.on('click', '.todo__list-item-remove', function (e) {
                    // Ищем ближайший предок, являющийся элементом списка, и удаляем его из DOM.
                    // Если у него были бы првязанные обработчики, .remove() бы их почистил,
                    // но их нет - они заданы на самом списке
                    $(this).closest('.todo__list-item').remove();
                });
            }

            /**
             * Метод добавления задачи в список
             * Параметры
             *  - Текст задачи
             *  - Флаг "выполнена" (сейчас не используется)
             */
            Todo.prototype.addItem = function(text, isCompleted) {
                // jQuery позволяет создавать DOM-объекты из HTML-строки
                var item = $(
                    '<li class="todo__list-item">'+
                    '<span class="todo__list-item-text"></span>' +
                    '<span class="todo__list-item-remove">&#10060;</span>' +
                    '</li>'
                );

                // Выставляем правильное состояние завершения в зависимости от isCompleted
                if (isCompleted) {
                    // метод .addClass уже реализован в jQuery, и нам не нужно писать его самим
                    item.addClass('todo__list-item_completed_yes');
                }

                // Мы в принципе могли подставить текст в строку, из которой создался элемент списка,
                // но тогда он был бы воспринят как HTML, а это очень небезопасно -
                // нельзя вставлять в страницу HTML от пользователя, не заэкранировав его
                // см. https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)
                item.find('.todo__list-item-text').text(text);

                // Вставляем созданный элемент в список
                this.eList.append(item);
            }

            // Инициализируем логику списка задач на элементе с id="list"
            // Поскольку мы не используем прямые селекторы внутри конструктора,
            // на странице может одновременно быть несколько списков,
            // которые никак друг другу не мешают
            var todo = new Todo($('#list'));
        });
    </script>
</head>
<body>
<div class="navbar">
    <ul>
        <li><a href="#"><b>Домашняя страница</b></a></li>
        <li><a href="#"><b>Группа</b></a></li>
        <li><a href="#"><b>Расписание</b></a></li>
        <li><a href="#"><b>Чат</b></a></li>
    </ul>
    <div class="profile">
        <a href="#"><img src="https://sun9-30.userapi.com/c855236/v855236163/96840/_gJAXx_rgkE.jpg"
                         class="profile-photo"></a>
    </div>
    <div class="profile-text">
        <b th:text="${user.name}"></b>
        <br>
        <b th:text ="${user.group.name}"></b><b th:text ="${user.level}"></b>
    </div>
</div>
<div class="timetable-today disp-inline">
    <h2>Расписание на сегодня:</h2>
    <ul>
        <li>8.00 - 9.35 ТФКП</li>
        <li>9.45 - 11:20 ТФКП</li>
        <li>11:20 - 13:05 ТФКП</li>
        <li>13:30 - 15:05 ТФКП</li>
        <li>8.00 - 9.35 ТФКП</li>
        <li>9.45 - 11:20 ТФКП</li>
        <li>11:20 - 13:05 ТФКП</li>
        <li>13:30 - 15:05 ТФКП</li>
    </ul>
</div>
<div id="list" class="todo">
    <h2 class="todo__caption">Мои задачи:</h2>
    <ul class="todo__list">
    </ul>
    <div class="todo__controls">
        <input type="text" class="todo__text"/>
        <button disabled="disabled" class="todo__add">Добавить</button>
    </div>
</div>
<div class="homework disp-inline">
    <h2>Домашнее задание:</h2>
    <ul>
        <li>ТФКП: №123, 124(а,б), 150</li>
        <li>ОС: написать реферат</li>
        <li>Диф. ур.: выучить теорему Ляпунова</li>
    </ul>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
</body>
</html>